# E09: Visualisierung für Fortgeschrittene

Erstelle folgende Grafiken mit `ggplot2`:

* Boxplots der Aranae Species pro Feldfruchttyp.

```{r}
library(ggplot2)
cropspecies = read.csv("data/crop_species.csv")


ggplot(cropspecies, mapping = aes(y = AraSpec, x = Croptype,
                                  fill = Croptype))+
    geom_boxplot()



legend_label = c("KM", "SM", "WR", "Winterweizen", "Roggen")

ggplot(cropspecies, mapping = aes(x = AraSpec, y = Croptype))+
    geom_boxplot(aes(fill = Croptype))+
    scale_y_discrete(labels = legend_label)+
    scale_fill_discrete(labels = legend_label)+
    theme_bw()


ggplot()+
    geom_boxplot(data = cropspecies, 
               mapping = aes(y = AraSpec, x = Croptype))+
    geom_point()+
    coord_flip()


```


* Scatterplot der Carabidae Individuen und Carabidae Species. Die Punkte sollen je nach Feldfrucht unterschiedlich gefärbt sein.

```{r}



dev.cur()
?Devices

png("~/test_png.png")

ggplot(cropspecies, aes(x = CaraInd, y = CaraSpec))+
    geom_point()+
    facet_wrap(facets = "Croptype")

dev.off()


ggsave("plot.png", p)


data(iris)
"iris"




ggplot(iris, aes(x = Sepal.Length, y = Sepal.Width, color = Species))+
    geom_point()

```


* Erstelle eine Karte der Bäume Münsters (nur mit ggplot!).

```{r}
trees = read.csv("data/muenster_trees.csv")


ggplot(trees, aes(x = X, y = Y))+
    geom_point(size = 0.1, alpha = 0.5)+
    scale_x_continuous(name = "Longitude")+
    coord_equal()





ggplot(trees, aes(x = X, y = Y))+
    geom_point(size = 0.1)+
    labs(title = "Muenster Trees",
         x = "Longitude",
         y = "Latitude")+
    coord_equal()+
    theme(legend.position = "none")

ggplot(trees, aes(x = X, y = Y))+
    geom_point(size = 0.1)+
    labs(title = "Muenster Trees",
         x = "Longitude",
         y = "Latitude")+
    coord_flip()+
    theme(legend.position = "none")


# räumliche Daten in R
library(sf)
library(mapview)
library(tmap)

trees_spatial = st_as_sf(trees, coords = c("X", "Y"), crs = 25832)
plot(trees_spatial)

mapview(trees_spatial)

tm_shape(trees_spatial)+
    tm_dots()

#


```


* Erstelle eine "heatmap" der Bäume in Münster (`geom_bin_2d` or `geom_hex`)

```{r}
library(viridis)
install.packages("colorpicker")
viridis(n = 10)

ggplot(trees, aes(x = X, y = Y))+
    geom_bin_2d()+
    geom_point(size = 0.01)+
    scale_fill_gradient(low = "yellow", high = "#990100")


ggplot(trees, aes(x = X, y = Y))+
    geom_hex()+
    scale_fill_gradient(low = "cyan1", high = "#990100")



ggplot(trees, aes(x = X, y = Y))+
    geom_bin_2d()+
    scale_fill_gradientn(colors = viridis(n = 10))

ggplot(trees, aes(x = X, y = Y))+
    geom_bin_2d()+
    scale_fill_gradientn(colors = c("#1874CD", "#458B00", "#CD3333"))
```


* Plotte die Zeitreihe der Sommertemperatur in Deutschland mit:
    * einer x-Achse in einem Zeitformat. Nutze `lubridate::years()` um das Datum vernünftig zu formatieren.
    * einer horizontalen Linie das langjährige Mittel der Temperatur zw. 1961 und 1990 anzeigt.
    * Färbe die Zeitreihe nach der Temperatur ein. Nutze eine geeignete Farbskala.
    
```{r}


temp = read.csv("https://opendata.dwd.de/climate_environment/CDC/regional_averages_DE/seasonal/air_temperature_mean/regional_averages_tm_summer.txt", sep = ";", skip = 1)



ref_mean = mean(temp$Deutschland[temp$Jahr > 1960 & temp$Jahr <=1990])

ggplot(temp, aes(x = Jahr, y = Deutschland))+
    geom_line()+
    scale_y_continuous(name = "Temperatur [°C]")+
    geom_point(aes(color = Deutschland), size = 2)+
    geom_hline(yintercept = ref_mean, linetype = "dashed")+
    scale_color_gradient2(name = "Temperatur [°C]", low = "darkblue", high = "firebrick", mid = "grey60", midpoint = ref_mean)+
    theme_bw()





```

